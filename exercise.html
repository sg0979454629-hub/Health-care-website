<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stretch Exercise</title>

<style>

body{
    font-family: Arial;
    background:#e9ecef;
    display:flex;
    justify-content:center;
    margin:0;
}

.phone{
    width:360px;
    background:white;
    min-height:100vh;
    padding:20px;
    box-sizing:border-box;
    text-align:center;
    position:relative;
}

/* ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö */
.back-btn{
    position:absolute;
    left:15px;
    top:15px;
    width:40px;
    height:40px;
    border-radius:50%;
    background:#ddd;
    color:black;
    font-size:18px;
    border:none;
    cursor:pointer;
}

img{
    width:100%;
    border-radius:15px;
    margin-top:20px;
}

.timer{
    font-size:40px;
    margin-top:15px;
    font-weight:bold;
}

input{
    padding:10px;
    font-size:16px;
    width:100px;
}

button{
    padding:10px 20px;
    font-size:16px;
    margin-top:10px;
    cursor:pointer;
    border:none;
    border-radius:8px;
    background:#4CAF50;
    color:white;
}

/* popup */
.popup{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.6);
    display:none;
    justify-content:center;
    align-items:center;
}

.popup-box{
    background:white;
    padding:20px;
    border-radius:15px;
    text-align:center;
}

.popup button{
    margin:10px;
}

</style>
</head>

<body>

<div class="phone">

<button class="back-btn" onclick="goHome()">‚¨Ö</button>

<h2>‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</h2>

<div id="setup">
‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ô‡∏≤‡∏ó‡∏µ)<br><br>
<input type="number" id="setTime" value="1"><br>
<button onclick="startExercise()">‡∏ï‡∏Å‡∏•‡∏á</button>
</div>

<div id="exercise" style="display:none;">
<img id="exerciseImage" src="">
<div class="timer" id="timer">00:00</div>
</div>

</div>

<!-- popup -->
<div class="popup" id="popup">
    <div class="popup-box">
        <h3>‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß</h3>
        <button onclick="nextStep()">‡∏ï‡∏Å‡∏•‡∏á</button>
        <button onclick="goHome()">‡∏¢‡πâ‡∏≠‡∏ô</button>
    </div>
</div>

<!-- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° preload + loop -->
<audio id="alarmSound" src="Clock.mp3" preload="auto" loop></audio>

<script>

const images = [
    "jog.jpg",
    "sit.jpg",
    "lay.jpg",
    "push.jpg",
    "jump.jpg"
];

let currentImage = 0;
let timeLeft = 0;
let interval;
let userTime = 0;

function startExercise(){

    userTime = parseInt(document.getElementById("setTime").value);

    if(userTime <= 0){
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡πÄ‡∏ß‡∏•‡∏≤");
        return;
    }

    userTime = userTime * 60;

    document.getElementById("setup").style.display = "none";
    document.getElementById("exercise").style.display = "block";

    currentImage = 0;
    showImage();
}

function showImage(){

    if(currentImage >= images.length){
        saveExerciseHistory();
        window.location.href = "index.html";
        return;
    }

    document.getElementById("exerciseImage").src = images[currentImage];

    timeLeft = userTime;
    updateTimer();

    clearInterval(interval);

    interval = setInterval(()=>{

        timeLeft--;
        updateTimer();

        if(timeLeft <= 0){

            clearInterval(interval);

            /* ‚úÖ ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á */
            let alarm = document.getElementById("alarmSound");
            alarm.currentTime = 0;
            alarm.play();

            document.getElementById("popup").style.display = "flex";
        }

    },1000);
}

function nextStep(){

    /* ‚úÖ ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡∏≠‡∏ô‡∏Å‡∏î‡∏ï‡∏Å‡∏•‡∏á */
    document.getElementById("alarmSound").pause();

    document.getElementById("popup").style.display = "none";
    currentImage++;
    showImage();
}

function goHome(){
    window.location.href = "index.html";
}

function updateTimer(){

    let minutes = Math.floor(timeLeft / 60);
    let seconds = timeLeft % 60;

    document.getElementById("timer").textContent =
        String(minutes).padStart(2,"0") + ":" +
        String(seconds).padStart(2,"0");
}

/* ---------------- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ ---------------- */

function randomMotivation(){

    let list = [
        "‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡∏°‡∏≤‡∏Å! ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß üí™",
        "‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡∏≠‡∏¢‡πà‡∏≤‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏∞ üî•",
        "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô ‚ù§Ô∏è",
        "‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡πÄ‡∏•‡∏¢ ‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏Ñ‡∏∏‡∏ì‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô ‚ú®",
        "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å üëè"
    ];

    return list[Math.floor(Math.random() * list.length)];
}

function saveExerciseHistory(){

    let history = JSON.parse(localStorage.getItem("history")) || [];

    let now = new Date();

    let record = {
        date: now.toLocaleDateString("th-TH"),
        time: now.toLocaleTimeString("th-TH"),
        activity: "‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢",
        summary: "‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
        motivate: randomMotivation()
    };

    history.push(record);

    localStorage.setItem("history", JSON.stringify(history));
}

</script>

</body>
</html>
